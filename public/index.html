<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário Estilizado</title>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            color: #333;
        }

        h1 {
            color: #222;
            margin: 2rem;
            text-align: center;
        }

        form {
            margin: auto;
            width: 90%;
            max-width: 800px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }

        th {
            background-color: #f7f7f7;
            font-weight: bold;
            color: #555;
        }

        input[type="number"],
        select,
        input[type="text"] {
            width: 95%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }

        button:hover {
            background-color: #45a049;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:nth-child(odd) {
            background-color: #fff;
        }

        tr th[colspan="4"] {
            text-align: center;
            font-size: 1.2em;
            color: #222;
        }
    </style>
</head>
<body>
    
    <h1>Controle de Tecido</h1>
    <form id="tecidoForm" action="/salvar" method="post">

        <a href="/dados">ver dados</a>
        <table>
            <thead>
                <tr>
                    <th>Código:</th>
                    <td colspan="2">
                        <input type="number" id="codigo" name="codigo" required>
                    </td>
                    <td>
                        <button type="button" id="btnTrazer">Trazer</button>
                    </td>
                </tr>
                <tr>
                    <th>Descrição:</th>
                    <td>
                        <select name="descricao" id="descricao" required>
                            <option value="TRADICIONAL">TRADICIONAL</option>
                            <option value="MODELO_LONG">MODELO LONG</option>
                            <option value="BABY_LOOK">BABY LOOK</option>
                        </select>
                    </td>
                    <th>Peso Tecido:</th>
                    <td>
                        <input type="number" name="pesoTecido" id="pesoTecido" required>
                    </td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>Tecido:</th>
                    <td>
                        <select name="tecido" id="tecido" required>
                            <option value="PP_BRANCO">PP BRANCO</option>
                            <option value="DRY_PREMIUM">DRY PREMIUM</option>
                            <option value="CACHAREL">CACHAREL</option>
                            <option value="POLIAMIDA_CAIO">POLIAMIDA CAIO</option>
                        </select>
                    </td>
                    <th>Metragem:</th>
                    <td>
                        <input type="number" name="metragem" id="metragem" required>
                    </td>
                </tr>
                <tr>
                    <th>Tipo:</th>
                    <td>
                        <select name="tipo" id="tipo" required>
                            <option value="MASCULINO">MASCULINO</option>
                            <option value="FEMININO">FEMININO</option>
                            <option value="INFANTIL">INFANTIL</option>
                        </select>
                    </td>
                    <th>Peso do Risco:</th>
                    <td>
                        <input type="number" name="pesoRisco" id="pesoRisco" required>
                    </td>
                </tr>
                <tr>
                    <th colspan="4">Tamanhos</th>
                </tr>
                <tr>
                    <td>
                        <label for="t_pp">PP</label>
                        <input type="number" name="t_pp" id="t_pp">
                    </td>
                    <td>
                        <label for="t_p">P</label>
                        <input type="number" name="t_p" id="t_p">
                    </td>
                    <td>
                        <label for="t_m">M</label>
                        <input type="number" name="t_m" id="t_m">
                    </td>
                    <td rowspan="2">
                        Outros: <input type="text" name="t_outros" id="t_outros">
                    </td>
                </tr>
                <tr>
                    <td>
                        <label for="t_g">G</label>
                        <input type="number" name="t_g" id="t_g">
                    </td>
                    <td>
                        <label for="t_gg">GG</label>
                        <input type="number" name="t_gg" id="t_gg">
                    </td>
                    <td>
                        <label for="t_xgg">XGG</label>
                        <input type="number" name="t_xgg" id="t_xgg">
                    </td>
                </tr>
                <tr>
                    <th>Camadas:</th>
                    <td colspan="3">
                        <input type="number" name="camadas" id="camadas">
                    </td>
                </tr>
                <tr>
                    <th>Quantidade Corte:</th>
                    <td colspan="3">
                        <input type="number" name="quantidadeCorte" id="qtdCorte">
                    </td>
                </tr>
                <tr>
                    <th>Concluído?</th>
                    <td colspan="3">
                        <label for="sim">Sim</label>
                        <input type="checkbox" name="concluido" id="sim" value="sim">
                        <label for="nao">Não</label>
                        <input type="checkbox" name="concluido" id="nao" value="nao">

                    </td>
                </tr>
            </tbody>
        </table>
        <button type="submit" class="btn btn-success mt-3">Enviar</button>
    </form>
    <script>
        document.querySelector('form').addEventListener('submit', async (event) => {
    event.preventDefault();

    let statusConcluido = 'nao';
    const checkboxSim = document.querySelector('input[name="concluido"][value="sim"]');
    const checkboxNao = document.querySelector('input[name="concluido"][value="nao"]');

    if (checkboxSim && checkboxSim.checked) {
        statusConcluido = 'sim';
    } else if (checkboxNao && checkboxNao.checked) {
        statusConcluido = 'nao';
    }

    const formData = {
        codigo: parseInt(document.querySelector('#codigo').value),
        descricao: document.querySelector('#descricao').value,
        pesoTecido: parseFloat(document.querySelector('#pesoTecido').value),
        tecido: document.querySelector('#tecido').value,
        metragem: parseFloat(document.querySelector('#metragem').value),
        tipo: document.querySelector('#tipo').value,
        pesoRisco: parseFloat(document.querySelector('#pesoRisco').value),
        tamanhos: {
            pp: parseInt(document.querySelector('#t_pp').value),
            p: parseInt(document.querySelector('#t_p').value),
            m: parseInt(document.querySelector('#t_m').value),
            g: parseInt(document.querySelector('#t_g').value),
            gg: parseInt(document.querySelector('#t_gg').value),
            xgg: parseInt(document.querySelector('#t_xgg').value),
        },
        camadas: parseInt(document.querySelector('#camadas').value),
        qtdCorte: parseInt(document.querySelector('#qtdCorte').value),
        concluido: statusConcluido
    };

    try {
        const response = await fetch('/salvar', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData),
        });

        if (response.ok) {
            alert("Dados enviados com sucesso!");
            document.querySelector('form').reset(); // Limpa o formulário
        } else {
            console.error("Erro ao enviar os dados");
            alert("Ocorreu um erro ao enviar os dados.");
        }
    } catch (error) {
        console.error('Erro ao enviar os dados:', error);
    }
});




document.getElementById('btnTrazer').addEventListener('click', async () => {
    const codigo = document.getElementById('codigo').value;
    if (codigo === "") {
        alert("Por favor, insira um código antes de buscar.");
        return;
    }

    try {
        const response = await fetch(`/codigo/${codigo}`);  // Ajuste a rota para a API do seu backend
        if (!response.ok) {
            alert("Erro ao buscar os dados.");
            return;
        }
        
        const data = await response.json();

        if (data) {
            document.getElementById('descricao').value = data.descricao || '';
            document.getElementById('pesoTecido').value = data.pesoTecido || '';
            document.getElementById('tecido').value = data.tecido || '';
            document.getElementById('metragem').value = data.metragem || '';
            document.getElementById('tipo').value = data.tipo || '';
            document.getElementById('pesoRisco').value = data.pesoRisco || '';

            document.getElementById('t_pp').value = data.tamanhos.pp || '';
            document.getElementById('t_p').value = data.tamanhos.p || '';
            document.getElementById('t_m').value = data.tamanhos.p || '';
            document.getElementById('t_g').value = data.tamanhos.g || '';
            document.getElementById('t_gg').value = data.tamanhos.gg || '';
            document.getElementById('t_xgg').value = data.tamanhos.xgg || '';

            document.getElementById('camadas').value = data.camadas || '';
            document.getElementById('qtdCorte').value = data.qtdCorte || '';

            // Manipulação dos checkbox
            const checkboxSim = document.querySelector('input[name="concluido"][value="sim"]');
            const checkboxNao = document.querySelector('input[name="concluido"][value="nao"]');
            
            if (data.concluido === 'sim') {
                checkboxSim.checked = true;
                createStatusSpan('Concluído: Sim');
            } else if (data.concluido === 'nao') {
                checkboxNao.checked = true;
                createStatusSpan('Concluído: Não');
            } else {
                checkboxSim.checked = false;
                checkboxNao.checked = false;
                document.getElementById('statusSpan').textContent = '';
            }

            
        } else {
            alert("Código não encontrado no banco de dados.");
        }
    } catch (error) {
        console.error("Erro ao buscar os dados:", error);
        alert("Ocorreu um erro ao buscar os dados.");
    }
});

function createStatusSpan(status) {
    let statusSpan = document.getElementById('statusSpan');
    if (!statusSpan) {
        statusSpan = document.createElement('span');
        statusSpan.id = 'statusSpan';
        document.body.appendChild(statusSpan);  // Adiciona o span ao body
    }
    statusSpan.textContent = status;
}


    </script>
</body>
</html>
